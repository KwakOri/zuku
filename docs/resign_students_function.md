학생 관리 페이지에 학생들의 정보를 한 번에 업로드하고 갱신하는 기능을 추가하고 싶어.
우리 학원은 학생들의 정보를 현재 외부 프로그램에서 관리하고 있어. 출결과 결제 때문에 모든 시스템을 우리 프로젝트로 이식하는 건 어렵고 학생들의 정보를 api로 연동할 수는 없어서 매번 양 쪽의 학생 정보를 갱신해줘야 해. 다만 그쪽에서 모든 학생의 정보를 엑셀 파일로 출력할 수는 있어서 이 엑셀 파일을 우리 프로그램에 넣으면 엑셀 파일의 데이터를 분석하고 기존 데이터와 비교해서 DB 데이터를 갱신하는 기능을 만들고 싶어.
일단 1번, 학생 정보 table에 재원 여부를 기록하는 컬럼이 새로 필요해. 기존 학생이 새로운 엑셀 파일에 없다면 퇴원했다는 이야기니까 그걸 기록할 칸이 필요해.
그리고 2번, 들어오는 데이터의 컬럼의 종류가 조금씩 다를 수 있지만 항상 반드시 들어와야 하는 정보들이 있어.

반명 - 학생이 현재 소속된 반
학생명 - 학생 이름
학교명 - 학생이 재학중인 학교 이름 ( -초, -중, -고로 끝남.)
학년 - 학생의 현재 학년
학생휴대폰 - 학생의 개인 휴대폰 번호
생년월일 - 학생의 생년 월일
성별 - 학생의 성별

이렇게 7개의 컬럼은 항상 존재할거고 이 컬럼들의 데이터를 DB에 기록할거야. 그러니 DB에 있는 students table의 데이터 구조 중에서 위 7가지 중에 없는 부분이 있다면 새로 column을 추가하는 sql문도 추가로 작성해줘.

내가 생각하는 작동 구조는 아래와 같아.

1. 학생 관리 페이지에서 "학생 정보 갱신" 을 누른다.
2. 학생 데이터들이 들어있는 Excel 파일 혹은 csv 파일을 넣는다.
3. 위의 7가지 column이 존재하는 지 확인한다. 없다면 에러 메세지를 출력한다.
4. 각 데이터들을 DB에 있는 학생들의 데이터와 비교한다. 휴대폰번호와 학년, 학교 등은 변경될 수 있기 때문에 이름과 생년월일을 기준으로 비교한다.
5. DB에 반영 예정인, 변경된 데이터들을 사용자에게 보여준다. 이 화면에는 새로 추가된 학생, 퇴원한 학생, 기존에 존재했지만 휴대폰 번호나 학교, 학년 등이 변경된 학생 등의 내용이 표시된다. 정보가 변경된 학생의 경우 어떤 컬럼에서 어떤 데이터가 변했는지도 같이 표시해줘야 한다. 예를 들면 휴대폰번호 010-1234-5678 -> 010-5555-5555 둥으로 표시해야 한다. 예외적으로 학교명은 기존에 있는 schools table을 조회해서 존재하는 학교인지 확인하고 schools table의 id를 외래키로 연결해준다.
6. 사용자가 모든 내용을 확인하고 확인 버튼을 누른다.
7. 모든 DB 데이터를 변경하기 전에, 사용자의 실수를 방지하기 위해 기존 DB에 있는 학생들의 목록을 csv 파일로 만들고 스토리지에 저장하는 백업 절차를 수행한다. (백업 스토리지는 추후 연결 예정)
8. 백업이 완료되면 DB에 모든 수정사항을 적용하는 코드를 실행한다.
9. 전송이 완료되면 쿼리 캐시를 초기화하는 로직을 수행한다.
